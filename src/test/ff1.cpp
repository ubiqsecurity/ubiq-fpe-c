#include <gtest/gtest.h>
#include <ubiq/fpe/ff1.h>

static
void ff1_test(const uint8_t * const K, const size_t k,
              const uint8_t * const T, const size_t t,
              const char * const PT, const char * const CT,
              const unsigned int radix)
{
    char * out;

    ASSERT_EQ(strlen(PT), strlen(CT));
    out = (char *)calloc(strlen(PT) + 1, 1);
    ASSERT_NE(out, nullptr);

    EXPECT_EQ(ff1_encrypt(out, K, k, T, t, PT, radix), 0);
    EXPECT_EQ(strcmp(out, CT), 0);

    EXPECT_EQ(ff1_decrypt(out, K, k, T, t, CT, radix), 0);
    EXPECT_EQ(strcmp(out, PT), 0);

    free(out);
}

TEST(ff1, nist1)
{
    const uint8_t K[] = {
        0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
        0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,
    };

    const uint8_t T[] = {};

    const char PT[] = "0123456789";
    const char CT[] = "2433477484";

    ff1_test(K, sizeof(K), T, sizeof(T), PT, CT, 10);
}

TEST(ff1, nist2)
{
    const uint8_t K[] = {
        0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
        0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,
    };

    const uint8_t T[] = {
        0x39, 0x38, 0x37, 0x36, 0x35, 0x34, 0x33, 0x32, 0x31, 0x30,
    };

    const char PT[] = "0123456789";
    const char CT[] = "6124200773";

    ff1_test(K, sizeof(K), T, sizeof(T), PT, CT, 10);
}

TEST(ff1, nist3)
{
    const uint8_t K[] = {
        0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
        0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,
    };

    const uint8_t T[] = {
        0x37, 0x37, 0x37, 0x37, 0x70, 0x71, 0x72, 0x73, 0x37, 0x37, 0x37,
    };

    const char PT[] = "0123456789abcdefghi";
    const char CT[] = "a9tv40mll9kdu509eum";

    ff1_test(K, sizeof(K), T, sizeof(T), PT, CT, 36);
}

TEST(ff1, nist4)
{
    const uint8_t K[] = {
        0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
        0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,
        0xef, 0x43, 0x59, 0xd8, 0xd5, 0x80, 0xaa, 0x4f,
    };

    const uint8_t T[] = {};

    const char PT[] = "0123456789";
    const char CT[] = "2830668132";

    ff1_test(K, sizeof(K), T, sizeof(T), PT, CT, 10);
}

TEST(ff1, nist5)
{
    const uint8_t K[] = {
        0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
        0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,
        0xef, 0x43, 0x59, 0xd8, 0xd5, 0x80, 0xaa, 0x4f,
    };

    const uint8_t T[] = {
        0x39, 0x38, 0x37, 0x36, 0x35, 0x34, 0x33, 0x32, 0x31, 0x30,
    };

    const char PT[] = "0123456789";
    const char CT[] = "2496655549";

    ff1_test(K, sizeof(K), T, sizeof(T), PT, CT, 10);
}

TEST(ff1, nist6)
{
    const uint8_t K[] = {
        0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
        0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,
        0xef, 0x43, 0x59, 0xd8, 0xd5, 0x80, 0xaa, 0x4f,
    };

    const uint8_t T[] = {
        0x37, 0x37, 0x37, 0x37, 0x70, 0x71, 0x72, 0x73, 0x37, 0x37, 0x37,
    };

    const char PT[] = "0123456789abcdefghi";
    const char CT[] = "xbj3kv35jrawxv32ysr";

    ff1_test(K, sizeof(K), T, sizeof(T), PT, CT, 36);
}

TEST(ff1, nist7)
{
    const uint8_t K[] = {
        0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
        0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,
        0xef, 0x43, 0x59, 0xd8, 0xd5, 0x80, 0xaa, 0x4f,
        0x7f, 0x03, 0x6d, 0x6f, 0x04, 0xfc, 0x6a, 0x94
    };

    const uint8_t T[] = {};

    const char PT[] = "0123456789";
    const char CT[] = "6657667009";

    ff1_test(K, sizeof(K), T, sizeof(T), PT, CT, 10);
}

TEST(ff1, nist8)
{
    const uint8_t K[] = {
        0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
        0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,
        0xef, 0x43, 0x59, 0xd8, 0xd5, 0x80, 0xaa, 0x4f,
        0x7f, 0x03, 0x6d, 0x6f, 0x04, 0xfc, 0x6a, 0x94
    };

    const uint8_t T[] = {
        0x39, 0x38, 0x37, 0x36, 0x35, 0x34, 0x33, 0x32, 0x31, 0x30,
    };

    const char PT[] = "0123456789";
    const char CT[] = "1001623463";

    ff1_test(K, sizeof(K), T, sizeof(T), PT, CT, 10);
}

TEST(ff1, nist9)
{
    const uint8_t K[] = {
        0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
        0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,
        0xef, 0x43, 0x59, 0xd8, 0xd5, 0x80, 0xaa, 0x4f,
        0x7f, 0x03, 0x6d, 0x6f, 0x04, 0xfc, 0x6a, 0x94
    };

    const uint8_t T[] = {
        0x37, 0x37, 0x37, 0x37, 0x70, 0x71, 0x72, 0x73, 0x37, 0x37, 0x37,
    };

    const char PT[] = "0123456789abcdefghi";
    const char CT[] = "xs8a0azh2avyalyzuwd";

    ff1_test(K, sizeof(K), T, sizeof(T), PT, CT, 36);
}
